- name: Add repositories
  apt_repository: repo='ppa:git-core/ppa' state=present

- name: Apt update
  apt: update_cache=true

- name: Set locale for god sake
  shell: "{{ item }}"
  with_items:
    - apt-get install --reinstall locales
    - dpkg-reconfigure locales
    - locale-gen en_US.UTF-8
    - update-locale LANG=en_US.UTF-8
    - dpkg-reconfigure locales
    - locale-gen en_US.UTF-8
    - locale-gen --no-purge --lang en_US.UTF-8
    - dpkg-reconfigure locales
    - export LANGUAGE="en_US.UTF-8"
    - export LC_ALL=en_US.UTF-8
    - echo 'LANGUAGE="en_US.UTF-8"' >> /etc/default/locale
    - echo 'LC_ALL="en_US.UTF-8"' >> /etc/default/locale

- name: Uninstall outdated stuff
  apt: pkg={{ item }} state=absent force=yes
  with_items:
    - tmux

- name: Install stuff
  apt: pkg={{ item }} state=present force=yes
  with_items:
    - aptitude
    - build-essential
    - curl
    - git
    - htop
    - libevent-dev
    - libncurses-dev
    - unzip

- name: Create ubuntu user
  user:
    name: "{{ user }}"
    shell: /bin/bash
    home: "{{ home }}"
    state: present

- name: Create .bash_aliases config for ubuntu user
  template: src=bash_aliases.j2 dest={{ home }}/.bash_aliases owner={{ user }} group={{ user }} mode=0644
  become: yes
  become_user: "{{ user }}"

- name: Download tmux
  get_url: url=https://github.com/tmux/tmux/releases/download/{{ tmux }}/tmux-{{ tmux }}.tar.gz dest=/tmp/ mode=0644
  become: yes
  become_user: "{{ user }}"
  tags:
    - tmux

- name: Unarchive tmux
  unarchive: src=/tmp/tmux-{{ tmux }}.tar.gz dest=/tmp/ copy=no
  become: yes
  become_user: "{{ user }}"
  tags:
    - tmux

- name: Unarchive tmux
  shell: cd /tmp/tmux-{{ tmux }} && ./configure --prefix={{ home }} && make --jobs=2 && make install
  become: yes
  become_user: "{{ user }}"
  tags:
    - tmux
